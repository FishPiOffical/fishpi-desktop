<template>
<div id="main" class="layout">
    <symbol id="redPacketIcon" viewBox="0 0 1024 1024">
        <path d="M705.2 445.28C689.12 536.48 608.608 606.256 512 606.256c-91.232 0-171.728-64.4-187.84-150.272l-134.16-80.496V783.36c0 59.04 48.304 101.968 101.968 101.968h440.064c59.04 0 101.968-48.288 101.968-101.968V370.128l-128.8 75.136zM512 219.856c91.232 0 166.368 64.4 187.84 150.256l134.16-85.856v-48.304c0-59.04-48.304-101.968-101.968-101.968H291.968c-53.664 0-101.968 42.928-101.968 101.968v59.04l134.16 80.48c16.112-91.216 96.608-155.616 187.84-155.616z" fill="#e6464b" p-id="4469"></path>
        <path d="M565.664 434.528h-26.832v-21.456h26.832c16.112 0 26.832-10.736 26.832-26.832 0-16.112-10.72-26.848-26.832-26.848h-16.096l32.208-32.192c10.72-10.72 10.72-26.832 0-37.568-10.736-10.72-26.848-10.72-37.568 0L512 327.2l-32.192-37.568c-10.736-10.72-26.848-10.72-37.568 0-10.736 10.72-10.736 26.832 0 37.568l32.192 32.192h-16.096c-16.096 0-26.832 10.736-26.832 26.848 0 16.096 10.72 26.832 26.832 26.832h32.192v21.456h-32.192c-16.096 0-26.832 10.736-26.832 26.832 0 16.112 10.72 26.848 26.832 26.848h32.192v37.568c0 16.096 10.736 26.816 26.848 26.816 16.096 0 26.832-10.72 26.832-26.816v-37.568h21.456c16.112 0 26.832-10.736 26.832-26.848 0-16.096-10.72-26.832-26.832-26.832z" fill="#fecd41" opacity="1" p-id="4470"></path>
    </symbol>
    <symbol id="emojiIcon" viewBox="0 0 1024 1024">
        <path d="M512.013 158.223c195.37 0 353.757 158.4 353.757 353.771 0 195.396-158.387 353.783-353.757 353.783-195.396 0-353.784-158.387-353.784-353.783 0-195.371 158.388-353.771 353.784-353.771z" fill="#FFDD67" p-id="35754"></path><path d="M394.985 399.441c38.588 0 69.855 30.14 69.855 67.299 0 37.176-31.267 67.316-69.855 67.316s-69.872-30.14-69.872-67.316c0-37.158 31.285-67.299 69.872-67.299zM699.236 582.745c-16.907-24.406-84.152 42.887-199.181 20.943-64.753-12.352-123.746-48.994-175.252-20.943-8.258 4.497-11.426 7.99-13.272 11.798-19.827 40.898 82.989 179.753 200.495 176.885 121.731-2.97 209.287-156.815 187.21-188.683z" fill="#4F0D0E" p-id="35755"></path>
        <path d="M620.26 653.51c-22.434 0.785-41.059 8.003-55.07 13.279-11.086 4.174-27.88 8.483-51.049 7.33-24.224 1.358-41.742-3.056-53.242-7.322-0.001 0-33.464-12.471-57.108-13.287-1.396-0.048-5.315-0.204-7.695 2.321-1.62 1.719-2.002 4.339-2.002 7.684v47.116c0 103.277 52.83 155.095 117.932 155.146 65.102-0.051 117.919-51.869 117.919-155.146 0-18.946 0-36.599-1.999-54.805-0.378-3.443-6.285-2.365-7.686-2.316z" fill="#FF717F" p-id="35756"></path>
        <path d="M529.691 674.119l-17.665 162.602-17.717-162.602z" fill="#E2596C" p-id="35757"></path>
        <path d="M544.564 464.71c0.403-0.628 0.663-1.106 0.992-1.646 0.309-0.527 0.64-1.021 0.961-1.528a70.941 70.941 0 0 1 1.996-2.945c1.355-1.937 2.797-3.78 4.27-5.607 2.969-3.621 6.153-7.051 9.51-10.329a133.671 133.671 0 0 1 22.351-17.437 130.08 130.08 0 0 1 26.349-12.584 119.694 119.694 0 0 1 29.676-6.211l3.869-0.251 3.891-0.087c2.6 0.002 5.207 0.014 7.815 0.213 1.304 0.072 2.608 0.163 3.912 0.305 1.303 0.134 2.609 0.235 3.905 0.447l3.892 0.587 3.86 0.786a96.283 96.283 0 0 1 15.012 4.612 95.92 95.92 0 0 1 13.885 6.966c4.362 2.711 8.531 5.668 12.3 9.008l1.427 1.23 1.364 1.295c0.91 0.857 1.802 1.731 2.684 2.609 0.86 0.899 1.7 1.815 2.529 2.734a46.646 46.646 0 0 1 2.418 2.805c0.784 0.949 1.539 1.923 2.295 2.884 0.754 0.963 1.432 1.995 2.142 2.983 0.677 1.023 1.403 1.989 2.018 3.052l1.867 3.136c2.387 4.241 4.439 8.629 5.895 13.355a7.797 7.797 0 0 1-9.851 9.716l-0.5-0.162c-2.237-0.723-4.276-1.583-6.308-2.394-2.07-0.763-3.978-1.663-5.964-2.403a246.29 246.29 0 0 0-5.74-2.313l-2.788-1.132c-0.931-0.357-1.862-0.701-2.765-1.071-7.285-2.881-14.256-5.198-20.959-7.169-3.358-0.978-6.69-1.76-9.962-2.541-3.289-0.73-6.563-1.316-9.831-1.857-6.543-1.027-13.162-1.629-19.983-1.531-13.622 0.132-27.989 2.672-42.849 6.816-7.43 2.069-14.978 4.53-22.653 7.258a483.242 483.242 0 0 0-11.613 4.281l-5.89 2.251-2.962 1.138c-0.496 0.185-0.979 0.386-1.477 0.562-0.476 0.164-1.021 0.392-1.406 0.489l-1.831 0.461a7.142 7.142 0 0 1-8.668-5.185 7.174 7.174 0 0 1 0.915-5.596z" fill="#4F0D0E" p-id="35758"></path>
    </symbol>
    <audio src="./static/shake.wav" ref="audio" v-show="false"></audio>
    <MainHeader id="header" :liveness="liveness" page="main"/>
    <Content id="content" class="content no-drag">
        <router-view />
    </Content>
    <Liveness id="liveness" :liveness="liveness" />
</div>
</template>

<script>
    import MainHeader from '../components/header.vue'
    import Liveness from '../components/liveness.vue'
    export default {
        name: 'home',
        components: {
            MainHeader, Liveness
        },
        async mounted () {
            if (!this.$root.isLogin()) return this.$router.push('/login');
            else this.$router.push('/chatroom');
            try {
                console.dir(await this.$root.getInfo());
            } catch (error) {
                console.log(error);
                this.$root.logout();
                return;
            }
            if (!this.$route.meta.notitle && this.$route.meta.title) this.$root.title = this.$route.meta.title;
            this.timer = setInterval(async () => {
                let liveness = await this.$fishpi.account.liveness();
                if (liveness > 0) this.$root.liveness = liveness;
            }, 60000);
            this.$root.notice.setAudio(this.$refs.audio);
            this.$root.notice.setApi(this.$fishpi);
        },
        beforeDestroy() {
            clearInterval(this.timer);
        },
        data () {
            return {
                timer: 0
            }
        },
        watch: {
        },
        filters: {
        },
        computed: {
            liveness() {
                return this.$root.liveness || 0
            },
        },
        methods: {

        }
    }
</script>
<style lang="less" scoped>
.layout {
    background: var(--global-background-color);
    height: 100%;
}
.content {
    background: var(--global-background-color);
    display: flex;
    justify-content: center;
    align-items: center;
    height: calc(100vh - 40px);
    margin: auto;
    flex-direction: column;
}
</style>
<style lang="less">
.md-style {
    a {
        border-bottom: 1px dashed #17233d;
    }
    img {
        max-height: 60vh;
        max-width: 40vw;
        cursor: pointer;
        background: #FFF;
        &[alt='图片表情'] {
            background: transparent;
        }
    }
    ul, ol {
        list-style-position: inside;
    }
    .msg-img {
        img.emoji {
            max-width: 40px;
        }
    }
    img.emoji {
        max-width: 20px;
        cursor: auto;
        vertical-align: middle;
        background: transparent;
    }
    h1,h2 {
        padding-bottom: .3em;
        border-bottom: 1px solid var(--markdown-head-border-color);
    }
    
    hr {
        background-color: var(--markdown-hr-color);
    }
    
    blockquote {
        color: var(--markdown-blockquote-color);
        border-left: .25em solid var(--markdown-blockquote-border-color);
        padding-left: 5px;
    }
    
    iframe {
        border: 0;
        width: 100%;
    }
    
    table tr {
        border-top: 1px solid var(--markdown-table-border-color);
        background-color: var(--markdown-table-background-color);
    }
    
    table td, table th {
        border: 1px solid var(--markdown-table-cell-border-color);
    }
    
    table tbody tr:nth-child(2n) {
        background-color: var(--markdown-table-even-color)
    }
    
    code:not(.hljs):not(.highlight-chroma) {
        background-color: var(--markdown-code-background-color)
    }

    pre,code {
        width: 100%;
        max-height: 300px;
        overflow: auto;
    }

    pre>code {
        margin: 0;
        font-size: 85%;
        padding: 0.5em;
        border-radius: 5px;
        display: block;
        overflow: auto;
        white-space: pre;
        font-family: mononoki,Consolas,"Liberation Mono",Menlo,Courier,monospace;
        word-break: initial;
        word-wrap: normal
    }
    
    kbd {
        color: var(--markdown-kdb-text-color);
        background-color: var(--markdown-kdb-background-color);
        border: 1px solid var(--markdown-kdb-border-color);
        box-shadow: inset 0 -1px 0 var(--markdown-kdb-shadow-color)
    }
}

.msg-img {
    img {
        max-width: 80%;
        width: auto;
    }
    [alt="图片表情"] {
        max-width: 100px;
    }
    iframe {
        border: 0;
    }
}
.msg-current {
    blockquote {
        color: var(--markdown-current-blockquote-color)
    }
}
.netease-music {
    position: relative;
    .netease-cover {
        z-index: 200;
        position: absolute;
        left: 10px; right: 10px; top: 10px; bottom: 18px;
        cursor: pointer;
    }
}
</style>